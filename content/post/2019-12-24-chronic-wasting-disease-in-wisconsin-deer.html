---
title: Chronic Wasting Disease in Wisconsin Deer
author: JVA
date: '2019-12-24'
slug: chronic-wasting-disease-in-wisconsin-deer
categories:
  - R
tags:
  - web scraping
  - map
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/datatables-binding/datatables.js"></script>
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="/rmarkdown-libs/dt-core/js/jquery.dataTables.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>


<p>Do you deer hunt in Wisconsin? Have you had your deer tested for chronic wasting disease? I recently learned the results of the test on my deer and was curious about the results statewide.</p>
<div id="bringing-in-the-data" class="section level1">
<h1>Bringing in the data</h1>
<p>The county data are available online at <a href="https://dnr.wi.gov/wmcwd/Summary/County">dnr.wi.gov</a>. I used <a href="https://cran.r-project.org/web/packages/rvest/vignettes/selectorgadget.html">SelectorGadget</a> to identify the columns of data I wanted from each page and the <strong>rvest</strong> package to do the extraction, looping through the pages with different years of data.</p>
<pre class="r"><code>library(tidyverse)
library(rvest)
library(maps)
library(DT)</code></pre>
<pre class="r"><code>prefix &lt;- &quot;https://dnr.wi.gov/wmcwd/Summary/YearCounty/&quot;
Years &lt;- c(&quot;1999-2001&quot;, 2002:2019)

# create empty list for results
results &lt;- setNames(vector(&quot;list&quot;, length(Years)), Years)

# loop through the years to fill up the list
for(i in 1:19) {
  County &lt;- read_html(paste0(prefix, Years[i])) %&gt;%
    html_nodes(&quot;td:nth-child(1)&quot;) %&gt;%
    html_text(trim=TRUE)
  Analyzed &lt;- read_html(paste0(prefix, Years[i])) %&gt;%
    html_nodes(&quot;td:nth-child(3)&quot;) %&gt;%
    html_text(trim=TRUE) %&gt;%
    as.numeric()
  Positive &lt;- read_html(paste0(prefix, Years[i])) %&gt;%
    html_nodes(&quot;td:nth-child(4)&quot;) %&gt;%
    html_text(trim=TRUE) %&gt;%
    as.numeric()
  results[[i]] &lt;- data.frame(County, Analyzed, Positive, 
    stringsAsFactors=FALSE)
}

# convert list to data frame
cwd &lt;- bind_rows(results, .id=&quot;Years&quot;) %&gt;%
  mutate(
    Year = as.numeric(ifelse(Years==&quot;1999-2001&quot;, &quot;2000&quot;, Years)),
    Pos.pct = 100*Positive/Analyzed,
    County = ifelse(County==&quot;Saint Croix&quot;, &quot;St Croix&quot;, County),
    county = casefold(County, upper=FALSE)
  ) %&gt;%
  filter(County!=&quot;Unknown&quot;)</code></pre>
<p>In preparation for mapping the results, I also downloaded county mapping data for Wisconsin.</p>
<pre class="r"><code>WI &lt;- map_data(&quot;county&quot;) %&gt;%
  filter(region==&quot;wisconsin&quot;) %&gt;%
  rename(county=subregion)

WIcenters &lt;- WI %&gt;%
  group_by(county) %&gt;%
  summarise(long=mean(range(long)), lat=mean(range(lat)))</code></pre>
</div>
<div id="summarizing-the-data" class="section level1">
<h1>Summarizing the data</h1>
<p>Then I summarized the test data, determining the first year that CWD was detected in each county and the percentage of positive results over all tests during 1999-2019 and just during 2019.</p>
<pre class="r"><code># summarize 2019 data
cwd19 &lt;- cwd %&gt;%
  filter(Year==2019) %&gt;%
  select(County, Analyzed.2019=Analyzed, Positive.2019=Positive, 
    Pos.pct.2019=Pos.pct)

# summarize all years of data
cwdall &lt;- cwd %&gt;%
  mutate(
    YP=ifelse(Positive&gt;0, Year, NA)
  ) %&gt;%
  group_by(County, county) %&gt;%
  summarize(
    First.Detected=min(YP, na.rm=TRUE), 
    Analyzed.Total=sum(Analyzed), 
    Positive.Total=sum(Positive)) %&gt;%
  mutate(
    Pos.pct.Total=100*Positive.Total/Analyzed.Total
  ) %&gt;%
  mutate(
    First.Detected=ifelse(is.finite(First.Detected), First.Detected, NA)
  ) %&gt;%
  full_join(cwd19) %&gt;%
  full_join(WIcenters) %&gt;%
  mutate(
    # mapit is missing for never detected and % positive for 2019 otherwise
    mapit = ifelse(Pos.pct.Total&gt;0, Pos.pct.2019, NA)
  ) %&gt;%
  arrange(-Pos.pct.Total, County)

cwdall %&gt;%
  select(-county, -lat, -long, -mapit) %&gt;%
  datatable() %&gt;%
  formatCurrency(c(&quot;Analyzed.Total&quot;, &quot;Positive.Total&quot;, 
    &quot;Analyzed.2019&quot;, &quot;Positive.2019&quot;), currency=&quot;&quot;, digits=0) %&gt;%
  formatRound(c(&quot;Pos.pct.Total&quot;, &quot;Pos.pct.2019&quot;), 1)</code></pre>
<div id="htmlwidget-1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72"],["Iowa","Sauk","Richland","Dane","Lafayette","Columbia","Grant","Rock","Green","Walworth","Adams","Crawford","Juneau","Vernon","Waukesha","Eau Claire","Milwaukee","Portage","Jefferson","Dodge","Oneida","Marquette","Sheboygan","Kenosha","Racine","Dunn","Lincoln","Washburn","Ashland","Barron","Bayfield","Brown","Buffalo","Burnett","Calumet","Chippewa","Clark","Door","Douglas","Florence","Fond du Lac","Forest","Green Lake","Iron","Jackson","Kewaunee","La Crosse","Langlade","Manitowoc","Marathon","Marinette","Menominee","Monroe","Oconto","Outagamie","Ozaukee","Pepin","Pierce","Polk","Price","Rusk","Sawyer","Shawano","St Croix","Taylor","Trempealeau","Vilas","Washington","Waupaca","Waushara","Winnebago","Wood"],[2002,2002,2002,2000,2004,2003,2006,2003,2003,2002,2012,2015,2012,2017,2012,2017,2017,2012,2005,2017,2017,2018,2019,2003,2012,2019,2017,2011,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[48595,18269,13958,30207,2982,6315,6048,8439,3456,7027,3491,2209,2779,3792,4089,1671,387,3364,7469,2423,2657,1734,1154,1157,1342,1520,1782,3214,705,1506,1521,335,2077,1983,197,1175,1701,853,1113,974,524,598,886,597,1911,436,1175,1301,943,2568,1640,44,2562,1285,681,295,485,699,1555,1407,1267,1422,2105,818,1150,1447,1780,874,1726,1744,359,1549],[3027,946,672,987,81,142,130,166,62,86,35,16,17,20,14,5,1,7,15,4,4,2,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[6.22903590904414,5.17817067162954,4.81444332998997,3.26745456351177,2.71629778672032,2.2486144101346,2.1494708994709,1.96705770825927,1.79398148148148,1.22385086096485,1.00257805786308,0.724309642372114,0.61173083843109,0.527426160337553,0.342382000489117,0.299222022740874,0.258397932816537,0.208085612366231,0.200830097737314,0.165084605860503,0.15054572826496,0.115340253748558,0.0866551126516465,0.0864304235090752,0.0745156482861401,0.0657894736842105,0.0561167227833895,0.0311138767890479,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1344,902,1344,990,193,547,634,126,142,96,337,420,352,747,193,358,40,362,143,156,408,330,73,21,40,393,261,192,35,166,170,25,371,199,13,203,209,17,135,94,34,44,107,61,175,14,160,119,33,364,208,8,424,119,33,52,71,44,207,240,129,146,202,131,89,252,135,112,185,106,19,182],[366,242,229,138,25,55,57,15,23,8,6,3,9,6,5,2,0,0,2,0,2,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[27.2321428571429,26.8292682926829,17.0386904761905,13.9393939393939,12.9533678756477,10.054844606947,8.99053627760252,11.9047619047619,16.1971830985915,8.33333333333333,1.78041543026706,0.714285714285714,2.55681818181818,0.803212851405622,2.59067357512953,0.558659217877095,0,0,1.3986013986014,0,0.490196078431373,0.303030303030303,1.36986301369863,0,0,0.254452926208651,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>County<\/th>\n      <th>First.Detected<\/th>\n      <th>Analyzed.Total<\/th>\n      <th>Positive.Total<\/th>\n      <th>Pos.pct.Total<\/th>\n      <th>Analyzed.2019<\/th>\n      <th>Positive.2019<\/th>\n      <th>Pos.pct.2019<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data) {\nDTWidget.formatCurrency(this, row, data, 3, \"\", 0, 3, \",\", \".\", true);\nDTWidget.formatCurrency(this, row, data, 4, \"\", 0, 3, \",\", \".\", true);\nDTWidget.formatCurrency(this, row, data, 6, \"\", 0, 3, \",\", \".\", true);\nDTWidget.formatCurrency(this, row, data, 7, \"\", 0, 3, \",\", \".\", true);\nDTWidget.formatRound(this, row, data, 5, 1, 3, \",\", \".\");\nDTWidget.formatRound(this, row, data, 8, 1, 3, \",\", \".\");\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
<p>Since 1999, <strong>28</strong> of 72 Wisconsin counties have tested positive for CWD, including <strong>2</strong> counties that tested positive for the first time in 2019: <strong>Sheboygan, Dunn</strong>.</p>
</div>
<div id="mapping-the-data" class="section level1">
<h1>Mapping the data</h1>
<p>I used the data to create a county map showing the percentage of positive results in 2019, the counties that have never tested positive for CWD, and the first year of detection.</p>
<pre class="r"><code>WIplus &lt;- cwdall %&gt;%
  select(-lat, -long) %&gt;%
  full_join(WI)

ggplot(WIplus, aes(long, lat)) +
  # county polygons
  geom_polygon(aes(group=group, fill=mapit), colour=&quot;white&quot;) +
  # black text on all counties with any detections since 1999
  geom_text(data=cwdall, size=3.5, fontface=&quot;bold&quot;, 
    aes(long, lat, label=substring(First.Detected, 3, 4))) +
  # writeover white text on dark colored counties
  geom_text(data=filter(cwdall, Pos.pct.Total&lt;1.1), size=3.5, fontface=&quot;bold&quot;, 
    color=&quot;white&quot;, aes(long, lat, label=substring(First.Detected, 3, 4))) +
  scale_fill_viridis_c(name=&quot;% Positive\nin 2019&quot;) +
  coord_map() +
  # remove default ggplot background, grid, and axes
  theme(
    panel.background = element_blank(),
    panel.grid = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
  ) +
  labs(title=&quot;Chronic Wasting Disease in Wisconsin Deer&quot;, 
    subtitle=&quot;Shading represents the percentage of deer that tested positive for CWD.\nCounties that have never tested positive since 1999 are in gray.\nLabels indicate the first year CWD was detected.&quot;)</code></pre>
<p><img src="/post/2019-12-24-chronic-wasting-disease-in-wisconsin-deer_files/figure-html/unnamed-chunk-6-1.png" width="576" /></p>
</div>
<div id="plotting-the-data" class="section level1">
<h1>Plotting the data</h1>
<p>Finally, to see the progression of the infection in the deer population over time, I plotted the percentage of positive results for every county that ever had a positive test. I only show percentages for years with at least 8 deer tested in each county. (<em>The combined data from 1999-2001 is plotted at 2000.</em>)</p>
<pre class="r"><code>cwd8 &lt;- cwd %&gt;%
  filter(Analyzed&gt;=8 &amp; County %in% cwdall$County[!is.na(cwdall$mapit)]) %&gt;%
  mutate(
    County=factor(County, levels=cwdall$County)
  )

ggplot(cwd8, aes(Year, Pos.pct)) +
  geom_smooth(color=&quot;cyan&quot;, size=1, method=&quot;loess&quot;, span=2) +
  geom_point(alpha=0.5) +
  scale_x_continuous(breaks=seq(2000, 2019, 5), 
    labels=substring(seq(2000, 2019, 5), 3, 4)) +
  facet_wrap(~ County) +
  labs(y=&quot;% Positive for CWD&quot;) +
  theme_bw(base_size=12)</code></pre>
<p><img src="/post/2019-12-24-chronic-wasting-disease-in-wisconsin-deer_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
